# vk_parser
Данная система позволяет получить список друзей ВКонтакте и состоит из двух файлов:
- main.py;
- vk_task.py;

## main.py
Чтобы запустить данную программу необходимо выполнить в командной строке (терминале) следующую команду:
```
python main.py <user_id> <access_token> [--output_format <format>] [--output_name <name>]
```
Где:
- `user_id` — ID пользователя ВКонтакте, список друзей которого вы хотите извлечь (обязательно);
- `access_token` — токен доступа к VK API, который вы должны получить на сайте VK API (обязательно);
- `--output_format` — формат выходного файла. Может быть CSV, JSON или TSV. Значение по умолчанию — CSV (необязательно);
- '--output_name' — имя выходного файла (путь выходного файла). Значение по умолчанию `report` (необязательно);


### Например
```
python main.py 123456789 token123 --output_format json --output_name my_friends
```
Данная команда выполнит извлечение списка друзей пользователя ВКонтакте с ID 123456789, используя токен доступа к VK API `token123`, и сохранит его в JSON-файл с именем `my_friends.json` в текущей директории.

## vk_task.py
Данный файл состоит из трех классов:
- HttpClient;
- Paginator;
- FriendsParser;


### HttpClient
Этот класс содержит один метод `request`, который выполняет HTTP-запрос к API-серверу ВКонтакте и возвращает информацию о друзьях в виде списка при условии, что код состояния ответа равен 200. В противном случае он вызывает исключение с соответствующем сообщением об ошибке.

### Paginator
Этот класс содержит два метода: `get_friends` и `get_all_friends`.  
Метод `get_friends` получает в качестве входных данных смещение (offset) и возвращает список друзей для заданного ID пользователя, ограниченный параметром count.  
Метод `get_all_friends` возращает список всех друзей пользователя (учет большого количества друзей).  
Оба метода используют класс `HttpClient` для выполнения HTTP-запроса к API-серверу ВКонтакте

### FriendsParser
Этот класс содержит пять методов: `parse`, `extract_data`, `get_value_from_data`, `get_date_value` и `create_report`.  
Метод `parse` отвечает за вызов метода `get_all_friends` класса `Paginator` и получение списка друзей пользователя.  
Метод `extract_data` извлекает следующую информацию о каждом друге из списка друзей, возращаемую классом `Paginator`:
- Имя;
- Фамилия;
- Страна;
- Город;
- Дата рождения в ISO формате;
- Пол;

Метод `get_value_from_data` используется для получения страны и города. Возвращает 'title' для страны и города соответственно.  
Метод `get_date_value` принимает дату в формате `DD.MM.YYYY` и возращает ее в ISO формате, т.е. `YYYY-MM-DD`. Если у пользователя отсутствует дата рождения или в ней отстутсвтует год рождения, то возрващается значение None. Вызывается методом `create_report`.  
Метод `create_report` создает отчет в одном из трех форматов: CSV, JSON и TSV, в соответствии со значением входного параметра `output_format`.
Метод `csv_tsv_file_write` используется для сохранения отчета либо в формат CSV, либо в TSV. Вызывается методом `create_report`.


## Использование:
1. Создайте экземпляр класса FriendsParser, передав следующие входные данные:
  - Авторизационный токен (`access_token`);
  - ID пользователя (`user_id`);
  - Формат выходного файла (`output_format`). По умолчанию - CSV;
  - Путь к выходному файлу (`output_name`). По умолчанию - файл с именем report в текущей директории;  
  ```python
  user_id = 123456789
  access_token = "your_access_token"
  parser = FriendsParser(user_id, access_token)
  ```
    
2. Выполните вызов метода `parse` чтобы получить всех друзей пользователя:
  ```python
  friends_list = parser.parse()
  ```

3. Выполните вызов метода `create_report`, чтобы создать отчет из списка друзей в одном из следующих форматов:
  - CSV;
  - TSV;
  - JSON;
  ```python
  parser.create_report(friends_list, output_format="csv", output_name="my_friends")
  ```

## Зависимости
Данная система зависит от следующих библиотек:
- `requests`;
- `structlog`;
- `typing`;
- `csv`;
- `json`;
- `datetime`;
- `argspace`;
